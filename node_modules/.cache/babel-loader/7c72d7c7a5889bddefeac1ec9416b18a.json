{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nexport default class ShaderAttribute {\n  constructor(dataColumn, opts) {\n    _defineProperty(this, \"opts\", void 0);\n\n    _defineProperty(this, \"source\", void 0);\n\n    this.opts = opts;\n    this.source = dataColumn;\n  }\n\n  get value() {\n    return this.source.value;\n  }\n\n  getValue() {\n    const buffer = this.source.getBuffer();\n    const accessor = this.getAccessor();\n\n    if (buffer) {\n      return [buffer, accessor];\n    }\n\n    const {\n      value\n    } = this.source;\n    const {\n      size\n    } = accessor;\n    let constantValue = value;\n\n    if (value && value.length !== size) {\n      constantValue = new Float32Array(size);\n      const index = accessor.elementOffset || 0;\n\n      for (let i = 0; i < size; ++i) {\n        constantValue[i] = value[index + i];\n      }\n    }\n\n    return constantValue;\n  }\n\n  getAccessor() {\n    return { ...this.source.getAccessor(),\n      ...this.opts\n    };\n  }\n\n}","map":{"version":3,"sources":["../../../../src/lib/attribute/shader-attribute.ts"],"names":["constructor","value","getValue","buffer","accessor","size","constantValue","index","i","getAccessor","opts"],"mappings":";AAYA,eAAe,MAAA,eAAA,CAAkD;AAI/DA,EAAAA,WAAW,CAAA,UAAA,EAAA,IAAA,EAAiE;AAAA,IAAA,eAAA,CAAA,IAAA,EAAA,MAAA,EAAA,KAAA,CAAA,CAAA;;AAAA,IAAA,eAAA,CAAA,IAAA,EAAA,QAAA,EAAA,KAAA,CAAA,CAAA;;AAE1E,SAAA,IAAA,GAAA,IAAA;AACA,SAAA,MAAA,GAAA,UAAA;AACD;;AAEQ,MAALC,KAAK,GAAwB;AAC/B,WAAO,KAAA,MAAA,CAAP,KAAA;AACD;;AAEDC,EAAAA,QAAQ,GAAmD;AACzD,UAAMC,MAAM,GAAG,KAAA,MAAA,CAAf,SAAe,EAAf;AACA,UAAMC,QAAQ,GAAG,KAAjB,WAAiB,EAAjB;;AACA,QAAA,MAAA,EAAY;AACV,aAAO,CAAA,MAAA,EAAP,QAAO,CAAP;AACD;;AAED,UAAM;AAACH,MAAAA;AAAD,QAAU,KAAhB,MAAA;AACA,UAAM;AAACI,MAAAA;AAAD,QAAN,QAAA;AACA,QAAIC,aAAa,GAAjB,KAAA;;AAEA,QAAIL,KAAK,IAAIA,KAAK,CAALA,MAAAA,KAAb,IAAA,EAAoC;AAClCK,MAAAA,aAAa,GAAG,IAAA,YAAA,CAAhBA,IAAgB,CAAhBA;AAEA,YAAMC,KAAK,GAAGH,QAAQ,CAARA,aAAAA,IAAd,CAAA;;AACA,WAAK,IAAII,CAAC,GAAV,CAAA,EAAgBA,CAAC,GAAjB,IAAA,EAA0B,EAA1B,CAAA,EAA+B;AAC7BF,QAAAA,aAAa,CAAbA,CAAa,CAAbA,GAAmBL,KAAK,CAACM,KAAK,GAA9BD,CAAwB,CAAxBA;AACD;AACF;;AAED,WAAA,aAAA;AACD;;AAEDG,EAAAA,WAAW,GAAG;AACZ,WAAO,EAEL,GAAG,KAAA,MAAA,CAFE,WAEF,EAFE;AAIL,SAAG,KAAKC;AAJH,KAAP;AAMD;;AA5C8D","sourcesContent":["/* eslint-disable complexity */\nimport type DataColumn from './data-column';\nimport type {BufferAccessor, ShaderAttributeOptions} from './data-column';\nimport type {Buffer} from '@luma.gl/webgl';\nimport type {NumericArray} from '../../types/types';\n\nexport interface IShaderAttribute {\n  value: NumericArray | null;\n  getValue(): [Buffer, BufferAccessor] | NumericArray | null;\n}\n\n/* This class creates a luma.gl-compatible \"view\" on top of a DataColumn instance */\nexport default class ShaderAttribute implements IShaderAttribute {\n  opts: ShaderAttributeOptions;\n  source: DataColumn<any, any>;\n\n  constructor(dataColumn: DataColumn<any, any>, opts: ShaderAttributeOptions) {\n    // Options that cannot be changed later\n    this.opts = opts;\n    this.source = dataColumn;\n  }\n\n  get value(): NumericArray | null {\n    return this.source.value;\n  }\n\n  getValue(): [Buffer, BufferAccessor] | NumericArray | null {\n    const buffer = this.source.getBuffer();\n    const accessor = this.getAccessor();\n    if (buffer) {\n      return [buffer, accessor];\n    }\n\n    const {value} = this.source;\n    const {size} = accessor;\n    let constantValue = value;\n\n    if (value && value.length !== size) {\n      constantValue = new Float32Array(size);\n      // initiate offset values\n      const index = accessor.elementOffset || 0; // element offset\n      for (let i = 0; i < size; ++i) {\n        constantValue[i] = value[index + i];\n      }\n    }\n\n    return constantValue;\n  }\n\n  getAccessor() {\n    return {\n      // source data accessor\n      ...this.source.getAccessor(),\n      // shader attribute overrides\n      ...this.opts\n    };\n  }\n}\n"]},"metadata":{},"sourceType":"module"}