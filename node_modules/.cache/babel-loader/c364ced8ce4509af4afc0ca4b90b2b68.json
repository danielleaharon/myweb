{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { deepEqual } from '../utils/deep-equal';\nimport LightingEffect from '../effects/lighting/lighting-effect';\nimport MaskEffect from '../effects/mask/mask-effect';\nconst DEFAULT_LIGHTING_EFFECT = new LightingEffect();\nexport default class EffectManager {\n  constructor() {\n    _defineProperty(this, \"effects\", void 0);\n\n    _defineProperty(this, \"_internalEffects\", void 0);\n\n    _defineProperty(this, \"_needsRedraw\", void 0);\n\n    this.effects = [];\n    this._internalEffects = [];\n    this._needsRedraw = 'Initial render';\n    this.setEffects();\n  }\n\n  setProps(props) {\n    if ('effects' in props) {\n      if (props.effects.length !== this.effects.length || !deepEqual(props.effects, this.effects)) {\n        this.setEffects(props.effects);\n        this._needsRedraw = 'effects changed';\n      }\n    }\n  }\n\n  needsRedraw(opts = {\n    clearRedrawFlags: false\n  }) {\n    const redraw = this._needsRedraw;\n\n    if (opts.clearRedrawFlags) {\n      this._needsRedraw = false;\n    }\n\n    return redraw;\n  }\n\n  getEffects() {\n    return this._internalEffects;\n  }\n\n  finalize() {\n    this.cleanup();\n  }\n\n  setEffects(effects = []) {\n    this.cleanup();\n    this.effects = effects;\n    this._internalEffects = effects.slice();\n\n    this._internalEffects.push(new MaskEffect());\n\n    if (!effects.some(effect => effect instanceof LightingEffect)) {\n      this._internalEffects.push(DEFAULT_LIGHTING_EFFECT);\n    }\n  }\n\n  cleanup() {\n    for (const effect of this.effects) {\n      effect.cleanup();\n    }\n\n    for (const effect of this._internalEffects) {\n      effect.cleanup();\n    }\n\n    this.effects.length = 0;\n    this._internalEffects.length = 0;\n  }\n\n}","map":{"version":3,"sources":["../../../src/lib/effect-manager.ts"],"names":["DEFAULT_LIGHTING_EFFECT","constructor","setProps","props","deepEqual","needsRedraw","opts","clearRedrawFlags","redraw","getEffects","finalize","setEffects","effects","effect","cleanup"],"mappings":";AAAA,SAAA,SAAA,QAAA,qBAAA;AACA,OAAA,cAAA,MAAA,qCAAA;AACA,OAAA,UAAA,MAAA,6BAAA;AAGA,MAAMA,uBAAuB,GAAG,IAAhC,cAAgC,EAAhC;AAEA,eAAe,MAAA,aAAA,CAAoB;AAKjCC,EAAAA,WAAW,GAAG;AAAA,IAAA,eAAA,CAAA,IAAA,EAAA,SAAA,EAAA,KAAA,CAAA,CAAA;;AAAA,IAAA,eAAA,CAAA,IAAA,EAAA,kBAAA,EAAA,KAAA,CAAA,CAAA;;AAAA,IAAA,eAAA,CAAA,IAAA,EAAA,cAAA,EAAA,KAAA,CAAA,CAAA;;AACZ,SAAA,OAAA,GAAA,EAAA;AACA,SAAA,gBAAA,GAAA,EAAA;AACA,SAAA,YAAA,GAAA,gBAAA;AACA,SAAA,UAAA;AACD;;AAEDC,EAAAA,QAAQ,CAAA,KAAA,EAAQ;AACd,QAAI,aAAJ,KAAA,EAAwB;AACtB,UAAIC,KAAK,CAALA,OAAAA,CAAAA,MAAAA,KAAyB,KAAA,OAAA,CAAzBA,MAAAA,IAAgD,CAACC,SAAS,CAACD,KAAK,CAAN,OAAA,EAAgB,KAA9E,OAA8D,CAA9D,EAA6F;AAC3F,aAAA,UAAA,CAAgBA,KAAK,CAArB,OAAA;AACA,aAAA,YAAA,GAAA,iBAAA;AACD;AACF;AACF;;AAEDE,EAAAA,WAAW,CAACC,IAAI,GAAG;AAACC,IAAAA,gBAAgB,EAAE;AAAnB,GAAR,EAAmD;AAC5D,UAAMC,MAAM,GAAG,KAAf,YAAA;;AACA,QAAIF,IAAI,CAAR,gBAAA,EAA2B;AACzB,WAAA,YAAA,GAAA,KAAA;AACD;;AACD,WAAA,MAAA;AACD;;AAEDG,EAAAA,UAAU,GAAG;AACX,WAAO,KAAP,gBAAA;AACD;;AAEDC,EAAAA,QAAQ,GAAG;AACT,SAAA,OAAA;AACD;;AAGDC,EAAAA,UAAU,CAACC,OAAiB,GAAlB,EAAA,EAAyB;AACjC,SAAA,OAAA;AACA,SAAA,OAAA,GAAA,OAAA;AAEA,SAAA,gBAAA,GAAwBA,OAAO,CAA/B,KAAwBA,EAAxB;;AAEA,SAAA,gBAAA,CAAA,IAAA,CAA2B,IAA3B,UAA2B,EAA3B;;AACA,QAAI,CAACA,OAAO,CAAPA,IAAAA,CAAaC,MAAM,IAAIA,MAAM,YAAlC,cAAKD,CAAL,EAA+D;AAC7D,WAAA,gBAAA,CAAA,IAAA,CAAA,uBAAA;AACD;AACF;;AAEDE,EAAAA,OAAO,GAAG;AACR,SAAK,MAAL,MAAA,IAAqB,KAArB,OAAA,EAAmC;AACjCD,MAAAA,MAAM,CAANA,OAAAA;AACD;;AAED,SAAK,MAAL,MAAA,IAAqB,KAArB,gBAAA,EAA4C;AAC1CA,MAAAA,MAAM,CAANA,OAAAA;AACD;;AACD,SAAA,OAAA,CAAA,MAAA,GAAA,CAAA;AACA,SAAA,gBAAA,CAAA,MAAA,GAAA,CAAA;AACD;;AA5DgC","sourcesContent":["import {deepEqual} from '../utils/deep-equal';\nimport LightingEffect from '../effects/lighting/lighting-effect';\nimport MaskEffect from '../effects/mask/mask-effect';\nimport type {Effect} from './effect';\n\nconst DEFAULT_LIGHTING_EFFECT = new LightingEffect();\n\nexport default class EffectManager {\n  effects: Effect[];\n  _internalEffects: Effect[];\n  _needsRedraw: false | string;\n\n  constructor() {\n    this.effects = [];\n    this._internalEffects = [];\n    this._needsRedraw = 'Initial render';\n    this.setEffects();\n  }\n\n  setProps(props) {\n    if ('effects' in props) {\n      if (props.effects.length !== this.effects.length || !deepEqual(props.effects, this.effects)) {\n        this.setEffects(props.effects);\n        this._needsRedraw = 'effects changed';\n      }\n    }\n  }\n\n  needsRedraw(opts = {clearRedrawFlags: false}): false | string {\n    const redraw = this._needsRedraw;\n    if (opts.clearRedrawFlags) {\n      this._needsRedraw = false;\n    }\n    return redraw;\n  }\n\n  getEffects() {\n    return this._internalEffects;\n  }\n\n  finalize() {\n    this.cleanup();\n  }\n\n  // Private\n  setEffects(effects: Effect[] = []) {\n    this.cleanup();\n    this.effects = effects;\n\n    this._internalEffects = effects.slice();\n    // Unique MaskEffect per EffectManager as GL context may be different\n    this._internalEffects.push(new MaskEffect());\n    if (!effects.some(effect => effect instanceof LightingEffect)) {\n      this._internalEffects.push(DEFAULT_LIGHTING_EFFECT);\n    }\n  }\n\n  cleanup() {\n    for (const effect of this.effects) {\n      effect.cleanup();\n    }\n\n    for (const effect of this._internalEffects) {\n      effect.cleanup();\n    }\n    this.effects.length = 0;\n    this._internalEffects.length = 0;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}